{"version":3,"file":"MarkMap.js","sources":["../../../src/client/components/MarkMap.ts"],"sourcesContent":["import { LoadingIcon, decodeData } from \"@vuepress/helper/client\";\nimport { useDebounceFn, useEventListener } from \"@vueuse/core\";\nimport type { Markmap } from \"markmap-view\";\nimport type { VNode } from \"vue\";\nimport {\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n} from \"vue\";\n\nimport \"../styles/markmap.scss\";\n\nexport default defineComponent({\n  name: \"MarkMap\",\n\n  props: {\n    /**\n     * Chart id\n     *\n     * 图表 id\n     */\n    id: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Markmap content\n     *\n     * Markmap\n     */\n    content: {\n      type: String,\n      required: true,\n    },\n  },\n\n  setup(props) {\n    const loading = ref(true);\n    const markupWrapper = shallowRef<HTMLElement>();\n    const markmapSvg = shallowRef<SVGElement>();\n\n    let markmap: Markmap | null = null;\n\n    useEventListener(\n      \"resize\",\n      useDebounceFn(() => {\n        void markmap?.fit();\n      }, 100),\n    );\n\n    onMounted(async () => {\n      const [{ Transformer }, { Markmap, deriveOptions }, { Toolbar }] =\n        await Promise.all([\n          import(/* webpackChunkName: \"markmap\" */ \"markmap-lib\"),\n          import(/* webpackChunkName: \"markmap\" */ \"markmap-view\"),\n          import(/* webpackChunkName: \"markmap\" */ \"markmap-toolbar\"),\n        ]);\n\n      const transformer = new Transformer();\n      const { frontmatter, root } = transformer.transform(\n        decodeData(props.content),\n      );\n\n      markmap = Markmap.create(\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        markmapSvg.value!,\n        deriveOptions({\n          maxWidth: 240,\n          ...frontmatter?.markmap,\n        }),\n      );\n\n      const { el } = Toolbar.create(markmap);\n\n      await markmap.setData(root);\n      await markmap.fit();\n\n      el.style.position = \"absolute\";\n      el.style.bottom = \"0.5rem\";\n      el.style.right = \"0.5rem\";\n\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      markupWrapper.value!.append(el);\n      loading.value = false;\n    });\n\n    onUnmounted(() => {\n      markmap?.destroy();\n      markmap = null;\n    });\n\n    return (): VNode =>\n      h(\"div\", { class: \"markmap-wrapper\", ref: markupWrapper }, [\n        h(\"svg\", {\n          ref: markmapSvg,\n          class: \"markmap-svg\",\n          id: props.id,\n        }),\n        loading.value\n          ? h(LoadingIcon, { class: \"markmap-loading\", height: 360 })\n          : null,\n      ]);\n  },\n});\n"],"names":["MarkMap","defineComponent","props","loading","ref","markupWrapper","shallowRef","markmapSvg","markmap","useEventListener","useDebounceFn","onMounted","Transformer","Markmap","deriveOptions","Toolbar","transformer","frontmatter","root","decodeData","el","onUnmounted","h","LoadingIcon"],"mappings":"8QAeA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,GAAI,CACF,KAAM,OACN,SAAU,EACZ,EAOA,QAAS,CACP,KAAM,OACN,SAAU,EACZ,CACF,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAUC,EAAI,EAAI,EAClBC,EAAgBC,IAChBC,EAAaD,EAAAA,EAEnB,IAAIE,EAA0B,KAE9B,OAAAC,EACE,SACAC,EAAc,IAAM,CACbF,GAAS,KAChB,EAAG,GAAG,CACR,EAEAG,EAAU,SAAY,CACpB,KAAM,CAAC,CAAE,YAAAC,CAAY,EAAG,CAAE,QAAAC,EAAS,cAAAC,CAAc,EAAG,CAAE,QAAAC,CAAQ,CAAC,EAC7D,MAAM,QAAQ,IAAI,CAChB,OAAyC,aAAa,EACtD,OAAyC,cAAc,EACvD,OAAyC,iBAAiB,CAC5D,CAAC,EAEGC,EAAc,IAAIJ,EAClB,CAAE,YAAAK,EAAa,KAAAC,CAAK,EAAIF,EAAY,UACxCG,EAAWjB,EAAM,OAAO,CAC1B,EAEAM,EAAUK,EAAQ,OAEhBN,EAAW,MACXO,EAAc,CACZ,SAAU,IACV,GAAGG,GAAa,OAClB,CAAC,CACH,EAEA,KAAM,CAAE,GAAAG,CAAG,EAAIL,EAAQ,OAAOP,CAAO,EAErC,MAAMA,EAAQ,QAAQU,CAAI,EAC1B,MAAMV,EAAQ,IAAI,EAElBY,EAAG,MAAM,SAAW,WACpBA,EAAG,MAAM,OAAS,SAClBA,EAAG,MAAM,MAAQ,SAGjBf,EAAc,MAAO,OAAOe,CAAE,EAC9BjB,EAAQ,MAAQ,EAClB,CAAC,EAEDkB,EAAY,IAAM,CAChBb,GAAS,UACTA,EAAU,IACZ,CAAC,EAEM,IACLc,EAAE,MAAO,CAAE,MAAO,kBAAmB,IAAKjB,CAAc,EAAG,CACzDiB,EAAE,MAAO,CACP,IAAKf,EACL,MAAO,cACP,GAAIL,EAAM,EACZ,CAAC,EACDC,EAAQ,MACJmB,EAAEC,EAAa,CAAE,MAAO,kBAAmB,OAAQ,GAAI,CAAC,EACxD,IACN,CAAC,CACL,CACF,CAAC"}