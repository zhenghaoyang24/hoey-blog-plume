{"version":3,"file":"ECharts.js","sources":["../../../src/client/components/ECharts.ts"],"sourcesContent":["import { LoadingIcon, decodeData } from \"@vuepress/helper/client\";\nimport { useDebounceFn, useEventListener } from \"@vueuse/core\";\nimport type { EChartsOption, EChartsType } from \"echarts\";\nimport type { PropType, VNode } from \"vue\";\nimport {\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n} from \"vue\";\n\nimport { useEChartsConfig } from \"../helpers/index.js\";\nimport \"../styles/echarts.scss\";\n\ninterface EChartsConfig {\n  width?: number;\n  height?: number;\n  option: EChartsOption;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nconst AsyncFunction = (async (): Promise<void> => {}).constructor;\n\nconst parseEChartsConfig = (\n  config: string,\n  type: \"js\" | \"json\",\n  myChart: EChartsType,\n): Promise<EChartsConfig> => {\n  if (type === \"js\") {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n    const runner = AsyncFunction(\n      \"myChart\",\n      `\\\nlet width,height,option,__echarts_config__;\n{\n${config}\n__echarts_config__={width,height,option};\n}\nreturn __echarts_config__;\n`,\n    );\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n    return runner(myChart) as Promise<EChartsConfig>;\n  }\n\n  return Promise.resolve({ option: JSON.parse(config) as EChartsOption });\n};\n\nexport default defineComponent({\n  name: \"ECharts\",\n\n  props: {\n    /**\n     * ECharts config\n     *\n     * 图表配置\n     */\n    config: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Chart id\n     *\n     * 图表 id\n     */\n    id: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Chart title\n     *\n     * 图表标题\n     */\n    title: String,\n\n    /**\n     * Chart config type\n     *\n     * 图表配置类型\n     */\n    type: {\n      type: String as PropType<\"js\" | \"json\">,\n      default: \"json\",\n    },\n  },\n\n  setup(props) {\n    const echartsConfig = useEChartsConfig();\n\n    const loading = ref(true);\n    const echartsContainer = shallowRef<HTMLElement>();\n\n    let instance: EChartsType | null = null;\n\n    useEventListener(\n      \"resize\",\n      useDebounceFn(() => {\n        instance?.resize();\n      }, 100),\n    );\n\n    onMounted(async () => {\n      const echarts = await import(/* webpackChunkName: \"echarts\" */ \"echarts\");\n\n      await echartsConfig.setup?.();\n\n      instance = echarts.init(echartsContainer.value);\n\n      const { option, ...size } = await parseEChartsConfig(\n        decodeData(props.config),\n        props.type,\n        instance,\n      );\n\n      instance.resize(size);\n      instance.setOption({ ...echartsConfig.option, ...option });\n\n      loading.value = false;\n    });\n\n    onUnmounted(() => {\n      instance?.dispose();\n    });\n\n    return (): (VNode | null)[] => [\n      props.title\n        ? h(\"div\", { class: \"echarts-title\" }, decodeURIComponent(props.title))\n        : null,\n      h(\"div\", { class: \"echarts-wrapper\" }, [\n        h(\"div\", {\n          ref: echartsContainer,\n          class: \"echarts-container\",\n          id: props.id,\n        }),\n        loading.value\n          ? h(LoadingIcon, { class: \"echarts-loading\", height: 360 })\n          : null,\n      ]),\n    ];\n  },\n});\n"],"names":["AsyncFunction","parseEChartsConfig","config","type","myChart","defineComponent","props","echartsConfig","useEChartsConfig","loading","ref","echartsContainer","shallowRef","instance","useEventListener","useDebounceFn","onMounted","echarts","option","size","decodeData","onUnmounted","h","LoadingIcon"],"mappings":"yTAuBA,MAAMA,GAAiB,SAA2B,CAAA,GAAI,YAEhDC,EAAqB,CACzBC,EACAC,EACAC,IAEID,IAAS,KAEIH,EACb,UACA;AAAA;AAAA,EAGJE,CAAM;AAAA;AAAA;AAAA;AAAA,CAKJ,EAGcE,CAAO,EAGhB,QAAQ,QAAQ,CAAE,OAAQ,KAAK,MAAMF,CAAM,CAAmB,CAAC,EAGxE,IAAeG,EAAAA,EAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,OAAQ,CACN,KAAM,OACN,SAAU,EACZ,EAOA,GAAI,CACF,KAAM,OACN,SAAU,EACZ,EAOA,MAAO,OAOP,KAAM,CACJ,KAAM,OACN,QAAS,MACX,CACF,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAgBC,IAEhBC,EAAUC,EAAI,EAAI,EAClBC,EAAmBC,EAAwB,EAEjD,IAAIC,EAA+B,KAEnC,OAAAC,EACE,SACAC,EAAc,IAAM,CAClBF,GAAU,OAAO,CACnB,EAAG,GAAG,CACR,EAEAG,EAAU,SAAY,CACpB,MAAMC,EAAU,KAA+C,QAAA,SAAS,EAExE,MAAMV,EAAc,UAEpBM,EAAWI,EAAQ,KAAKN,EAAiB,KAAK,EAE9C,KAAM,CAAE,OAAAO,EAAQ,GAAGC,CAAK,EAAI,MAAMlB,EAChCmB,EAAWd,EAAM,MAAM,EACvBA,EAAM,KACNO,CACF,EAEAA,EAAS,OAAOM,CAAI,EACpBN,EAAS,UAAU,CAAE,GAAGN,EAAc,OAAQ,GAAGW,CAAO,CAAC,EAEzDT,EAAQ,MAAQ,EAClB,CAAC,EAEDY,EAAY,IAAM,CAChBR,GAAU,SACZ,CAAC,EAEM,IAAwB,CAC7BP,EAAM,MACFgB,EAAE,MAAO,CAAE,MAAO,eAAgB,EAAG,mBAAmBhB,EAAM,KAAK,CAAC,EACpE,KACJgB,EAAE,MAAO,CAAE,MAAO,iBAAkB,EAAG,CACrCA,EAAE,MAAO,CACP,IAAKX,EACL,MAAO,oBACP,GAAIL,EAAM,EACZ,CAAC,EACDG,EAAQ,MACJa,EAAEC,EAAa,CAAE,MAAO,kBAAmB,OAAQ,GAAI,CAAC,EACxD,IACN,CAAC,CACH,CACF,CACF,CAAC"}