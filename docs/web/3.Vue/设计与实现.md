---
title: 设计与实现
createTime: 2025/11/17 17:37:49
permalink: /web/vue/principle/
---

## 响应系统

响应系统是 Vue.js 的核心，是实现数据追踪和视图更新的关键。

### 初识 Proxy

一般的 JS 对象数据并不会追踪更新，当它被改变时，那些依赖它的副作用函数并不知道它变了。

``` js
const obj = {
    name: '张三',
    age: 18
}

function changeAge() {
    document.body.innerHTML = obj.age
}

changeAge()

setTimeout(() => {
    obj.age = 19 // 1 秒后 age 改变，但视图不会更新
},1000)

```

上面的例子中，虽然 `obj.age` 被改变了，但函数 `changeAge` 并不知道它被改变了，因此它也不会被执行，视图就不会更新。所以，如果我们
能够拦截一个对象的读取和更改，就能够追踪到数据变化。

[Proxy](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy) 是 ES6 新增的 API，它可以拦截对目标对象的操。例如对象被访问了、被更改了，并可以自定义这些行为。所以我们可以创建一个 Proxy 来拦截对对象属性的访问和修改，来实现响应式数据。

1. 创建一个 Proxy 对象

创建一个基本对象，并使用 Proxy 进行代理，自定义 `get` 与 `set` 行为。

``` js
const obj = {
    name: '张三',
    age: 18
}

const proxyData = new Proxy(obj, {
    get(target, key) {
        console.log('get', key)
        return target[key]
    },
    set(target, key, value) {
        console.log('set', key, value)
        target[key] = value
        return true
    }
})
```

此时 `proxyData` 就是 `obj` 的代理对象，当访问 `proxyData` 的属性时，会触发 `get` 行为，当修改 `proxyData` 的属性时，会触发 `set` 行为。
现在还缺少副作用函数的执行，因此还需要一个函数来执行副作用函数。
